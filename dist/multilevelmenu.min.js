!function(t){"use strict";function e(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function n(t,n){this.el=t,this.options=e({},this.options),e(this.options,n),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.current_menu=0;var r;this.menus.forEach(function(t,e){t.querySelectorAll(".menu__item").forEach(function(t){t.querySelector(".menu__link--current")&&(r=e)})}),r&&(this.current_menu=r),this._init()}var r=function(t,e){var n=function(t){t.target===this&&(this.removeEventListener("animationend",n),e&&"function"==typeof e&&e.call())};t.addEventListener("animationend",n)};n.prototype.options={breadcrumbsCtrl:!0,initialBreadcrumb:"all",backCtrl:!0,itemsDelayInterval:60,direction:"r2l",onItemClick:function(){return!1}},n.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var t=this,e=[];this.menus.forEach(function(n,r){var i={menuEl:n,menuItems:[].slice.call(n.querySelectorAll(".menu__item"))};t.menusArr.push(i),r===t.current_menu&&n.classList.add("menu__level--current"),n.querySelectorAll(".menu__link").forEach(function(t){var n=t.getAttribute("data-submenu");if(n){var i={menu:n,name:t.innerHTML};e[r]?e[r].push(i):(e[r]=[],e[r].push(i))}})}),this.menus.forEach(function(n,r){var i=n.getAttribute("data-menu");e.forEach(function(e,n){e.forEach(function(e){e.menu===i&&(t.menusArr[r].backIdx=n,t.menusArr[r].name=e.name)})})}),t.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.breadcrumbsCtrl.setAttribute("aria-label","You are here"),this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),0!==t.menusArr[t.current_menu].backIdx&&0!==t.current_menu&&(this._crawlCrumbs(t.menusArr[t.current_menu].backIdx,t.menusArr),this.breadCrumbs=!0),0!==t.current_menu&&(this._addBreadcrumb(t.current_menu),this.breadCrumbs=!0)),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML='<span class="icon icon--arrow-left"></span>',this.el.insertBefore(this.backCtrl,this.el.firstChild)),this._initEvents()},n.prototype._initEvents=function(){for(var t=this,e=0,n=this.menusArr.length;e<n;++e)this.menusArr[e].menuItems.forEach(function(e,n){e.querySelector("a").addEventListener("click",function(e){var r=e.target.getAttribute("data-submenu"),i=e.target.innerHTML,s=t.el.querySelector('ul[data-menu="'+r+'"]');r&&s?(e.preventDefault(),t._openSubMenu(s,n,i)):(t.el.querySelector(".menu__link--current")&&t.el.querySelector(".menu__link--current").classList.remove("menu__link--current"),e.target.classList.add("menu__link--current"),t.options.onItemClick(e,i))})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){t._back()})},n.prototype._openSubMenu=function(t,e,n){if(this.isAnimating)return!1;this.isAnimating=!0,this.menusArr[this.menus.indexOf(t)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(t)].name=n,this._menuOut(e),this._menuIn(t,e)},n.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var t=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(t),this.options.breadcrumbsCtrl&&this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild)},n.prototype._menuOut=function(t){var e=this,n=this.menusArr[this.current_menu].menuEl,r=void 0===t;this.menusArr[this.current_menu].menuItems.forEach(function(n,i){n.style.WebkitAnimationDelay=n.style.animationDelay=r?parseInt(i*e.options.itemsDelayInterval)+"ms":parseInt(Math.abs(t-i)*e.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?n.classList.add(r?"animate-outToRight":"animate-outToLeft"):n.classList.add(r?"animate-outToLeft":"animate-outToRight")},n.prototype._menuIn=function(t,e){var n=this,i=this.menusArr[this.current_menu].menuEl,s=void 0===e,a=this.menus.indexOf(t),u=this.menusArr[a].menuItems,m=u.length;u.forEach(function(u,o){u.style.WebkitAnimationDelay=u.style.animationDelay=s?parseInt(o*n.options.itemsDelayInterval)+"ms":parseInt(Math.abs(e-o)*n.options.itemsDelayInterval)+"ms",o===(e<=m/2||s?m-1:0)&&r(u,function(){"r2l"===n.options.direction?(i.classList.remove(s?"animate-outToRight":"animate-outToLeft"),t.classList.remove(s?"animate-inFromLeft":"animate-inFromRight")):(i.classList.remove(s?"animate-outToLeft":"animate-outToRight"),t.classList.remove(s?"animate-inFromRight":"animate-inFromLeft")),i.classList.remove("menu__level--current"),t.classList.add("menu__level--current"),n.current_menu=a,s?0===n.current_menu&&n.options.backCtrl&&n.backCtrl.classList.add("menu__back--hidden"):(n.options.backCtrl&&n.backCtrl.classList.remove("menu__back--hidden"),n._addBreadcrumb(a)),n.isAnimating=!1,t.focus()})}),"r2l"===this.options.direction?t.classList.add(s?"animate-inFromLeft":"animate-inFromRight"):t.classList.add(s?"animate-inFromRight":"animate-inFromLeft")},n.prototype._addBreadcrumb=function(t){if(!this.options.breadcrumbsCtrl)return!1;var e=document.createElement("a");e.href="#",e.innerHTML=t?this.menusArr[t].name:this.options.initialBreadcrumb,this.breadcrumbsCtrl.appendChild(e);var n=this;e.addEventListener("click",function(r){if(r.preventDefault(),!e.nextSibling||n.isAnimating)return!1;n.isAnimating=!0,n._menuOut();var i=n.menusArr[t].menuEl;n._menuIn(i);for(var s;s=e.nextSibling;)n.breadcrumbsCtrl.removeChild(s)})},n.prototype._crawlCrumbs=function(t,e){0!==e[t].backIdx&&this._crawlCrumbs(e[t].backIdx,e),this._addBreadcrumb(t)},t.MLMenu=n}(window);