!function(r){"use strict";r.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||r;for(var n=0;n<this.length;n++)t.call(e,this[n],n,this)});function i(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function t(t,e){var n;this.el=t,this.options=i({},this.options),i(this.options,e),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.current_menu=0,this.menus.forEach(function(t,e){t.querySelectorAll(".menu__item").forEach(function(t){t.querySelector(".menu__link--current")&&(n=e)})}),n&&(this.current_menu=n),this._init()}t.prototype.options={breadcrumbsCtrl:!0,initialBreadcrumb:"all",backCtrl:!0,itemsDelayInterval:60,direction:"r2l",onItemClick:function(){return!1}},t.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var i=this,s=[];this.menus.forEach(function(t,r){var e={menuEl:t,menuItems:[].slice.call(t.querySelectorAll(".menu__item"))};i.menusArr.push(e),r===i.current_menu&&t.classList.add("menu__level--current"),t.querySelectorAll(".menu__link").forEach(function(t){var e=t.getAttribute("data-submenu");if(e){var n={menu:e,name:t.innerHTML};s[r]||(s[r]=[]),s[r].push(n)}})}),this.menus.forEach(function(t,n){var r=t.getAttribute("data-menu");s.forEach(function(t,e){t.forEach(function(t){t.menu===r&&(i.menusArr[n].backIdx=e,i.menusArr[n].name=t.name)})})}),i.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.breadcrumbsCtrl.setAttribute("aria-label","You are here"),this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),0!==i.menusArr[i.current_menu].backIdx&&0!==i.current_menu&&(this._crawlCrumbs(i.menusArr[i.current_menu].backIdx,i.menusArr),this.breadCrumbs=!0),0!==i.current_menu&&(this._addBreadcrumb(i.current_menu),this.breadCrumbs=!0)),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML='<span class="icon icon--arrow-left"></span>',this.el.insertBefore(this.backCtrl,this.el.firstChild)),this._initEvents()},t.prototype._initEvents=function(){for(var s=this,t=0,e=this.menusArr.length;t<e;++t)this.menusArr[t].menuItems.forEach(function(t,i){t.querySelector("a").addEventListener("click",function(t){var e=t.target.getAttribute("data-submenu"),n=t.target.innerHTML,r=s.el.querySelector('ul[data-menu="'+e+'"]');e&&r?(t.preventDefault(),s._openSubMenu(r,i,n)):(s.el.querySelector(".menu__link--current")&&s.el.querySelector(".menu__link--current").classList.remove("menu__link--current"),t.target.classList.add("menu__link--current"),s.options.onItemClick(t,n))})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){s._back()})},t.prototype._openSubMenu=function(t,e,n){if(this.isAnimating)return!1;this.isAnimating=!0,this.menusArr[this.menus.indexOf(t)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(t)].name=n,this._menuOut(e),this._menuIn(t,e)},t.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var t=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(t),this.options.breadcrumbsCtrl&&this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild)},t.prototype._menuOut=function(n){var r=this,t=this.menusArr[this.current_menu].menuEl,i=void 0===n;this.menusArr[this.current_menu].menuItems.forEach(function(t,e){t.style.WebkitAnimationDelay=t.style.animationDelay=i?parseInt(e*r.options.itemsDelayInterval)+"ms":parseInt(Math.abs(n-e)*r.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?t.classList.add(i?"animate-outToRight":"animate-outToLeft"):t.classList.add(i?"animate-outToLeft":"animate-outToRight")},t.prototype._menuIn=function(i,s){var a=this,u=this.menusArr[this.current_menu].menuEl,m=void 0===s,o=this.menus.indexOf(i),t=this.menusArr[o].menuItems,c=t.length;t.forEach(function(t,e){var n,r;t.style.WebkitAnimationDelay=t.style.animationDelay=m?parseInt(e*a.options.itemsDelayInterval)+"ms":parseInt(Math.abs(s-e)*a.options.itemsDelayInterval)+"ms",e===(s<=c/2||m?c-1:0)&&(n=function(){"r2l"===a.options.direction?(u.classList.remove(m?"animate-outToRight":"animate-outToLeft"),i.classList.remove(m?"animate-inFromLeft":"animate-inFromRight")):(u.classList.remove(m?"animate-outToLeft":"animate-outToRight"),i.classList.remove(m?"animate-inFromRight":"animate-inFromLeft")),u.classList.remove("menu__level--current"),i.classList.add("menu__level--current"),a.current_menu=o,m?0===a.current_menu&&a.options.backCtrl&&a.backCtrl.classList.add("menu__back--hidden"):(a.options.backCtrl&&a.backCtrl.classList.remove("menu__back--hidden"),a._addBreadcrumb(o)),a.isAnimating=!1,i.focus()},r=function(t){t.target===this&&(this.removeEventListener("animationend",r),n&&"function"==typeof n&&n.call())},t.addEventListener("animationend",r))}),"r2l"===this.options.direction?i.classList.add(m?"animate-inFromLeft":"animate-inFromRight"):i.classList.add(m?"animate-inFromRight":"animate-inFromLeft")},t.prototype._addBreadcrumb=function(r){if(!this.options.breadcrumbsCtrl)return!1;var i=document.createElement("a");i.href="#",i.innerHTML=r?this.menusArr[r].name:this.options.initialBreadcrumb,this.breadcrumbsCtrl.appendChild(i);var s=this;i.addEventListener("click",function(t){if(t.preventDefault(),!i.nextSibling||s.isAnimating)return!1;s.isAnimating=!0,s._menuOut();var e,n=s.menusArr[r].menuEl;for(s._menuIn(n);e=i.nextSibling;)s.breadcrumbsCtrl.removeChild(e)})},t.prototype._crawlCrumbs=function(t,e){0!==e[t].backIdx&&this._crawlCrumbs(e[t].backIdx,e),this._addBreadcrumb(t)},r.MLMenu=t}(window);