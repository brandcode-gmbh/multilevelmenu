!function(i){"use strict";i.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||i;for(var n=0;n<this.length;n++)t.call(e,this[n],n,this)});function r(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function t(t,e){var n;this.el=t,this.options=r({},this.options),r(this.options,e),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.wrapper=this.el.querySelector(".menu__wrap"),this.current_menu=0,this.menus.forEach(function(t,e){t.querySelectorAll(".menu__item").forEach(function(t){t.querySelector(".menu__link--current")&&(n=e)})}),n&&(this.current_menu=n),this._init()}t.prototype.options={breadcrumbsCtrl:!0,breadcrumbsLabel:"You are here",initialBreadcrumb:"all",initialBreadcrumbClass:"",backCtrl:!0,backCtrlContent:'<span class="icon icon--arrow-left"></span>',itemsDelayInterval:60,direction:"r2l",onItemClick:function(){return!1}},t.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var r=this,s=[];this.menus.forEach(function(t,i){var e={menuEl:t,menuItems:[].slice.call(t.querySelectorAll(".menu__item"))};r.menusArr.push(e),i===r.current_menu&&t.classList.add("menu__level--current"),t.querySelectorAll(".menu__link").forEach(function(t){var e=t.getAttribute("data-submenu");if(e){var n={menu:e,name:t.innerHTML};s[i]||(s[i]=[]),s[i].push(n)}})}),this.menus.forEach(function(t,n){var i=t.getAttribute("data-menu");s.forEach(function(t,e){t.forEach(function(t){t.menu===i&&(r.menusArr[n].backIdx=e,r.menusArr[n].name=t.name)})})}),r.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.breadcrumbsCtrl.setAttribute("aria-label",r.options.breadcrumbsLabel),this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),r.current_menu&&0!==r.menusArr[r.current_menu].backIdx&&0!==r.current_menu&&(this._crawlCrumbs(r.menusArr[r.current_menu].backIdx,r.menusArr),this.breadCrumbs=!0),0!==r.current_menu&&(this._addBreadcrumb(r.current_menu),this.breadCrumbs=!0)),this.menus.forEach(function(t){t.classList.contains("menu__level--current")&&r._resizeFor(t)}),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML=this.options.backCtrlContent,this.el.insertBefore(this.backCtrl,this.wrapper)),this._initEvents()},t.prototype._initEvents=function(){for(var a=this,t=0,e=this.menusArr.length;t<e;++t)this.menusArr[t].menuItems.forEach(function(t,s){t.querySelector("a").addEventListener("click",function(t){var e=t.target.closest("a"),n=e.getAttribute("data-submenu"),i=e.innerHTML,r=a.el.querySelector('ul[data-menu="'+n+'"]');n&&r?(t.preventDefault(),a._openSubMenu(r,s,i)):(a.el.querySelector(".menu__link--current").classList.remove("menu__link--current"),e.classList.add("menu__link--current"),a.options.onItemClick(t,i))})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){a._back()})},t.prototype._openSubMenu=function(t,e,n){if(this.isAnimating)return!1;this.isAnimating=!0,this.menusArr[this.menus.indexOf(t)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(t)].name=n,this._menuOut(e),this._menuIn(t,e)},t.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var t=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(t),this.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild),1===this.breadcrumbsCtrl.childElementCount&&this.breadcrumbsCtrl.firstElementChild.classList.add("invisible"))},t.prototype._menuOut=function(n){var i=this,t=this.menusArr[this.current_menu].menuEl,r=void 0===n;this.menusArr[this.current_menu].menuItems.forEach(function(t,e){t.style.WebkitAnimationDelay=t.style.animationDelay=r?parseInt(e*i.options.itemsDelayInterval)+"ms":parseInt(Math.abs(n-e)*i.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?t.classList.add(r?"animate-outToRight":"animate-outToLeft"):t.classList.add(r?"animate-outToLeft":"animate-outToRight")},t.prototype._resizeFor=function(t){var e=t.offsetHeight;this.wrapper.style.minHeight=e+"px"},t.prototype._menuIn=function(r,s){var a=this,u=this.menusArr[this.current_menu].menuEl,o=void 0===s,m=this.menus.indexOf(r),t=this.menusArr[m].menuItems,c=t.length;a._resizeFor(r),t.forEach(function(t,e){var n,i;t.style.WebkitAnimationDelay=t.style.animationDelay=o?parseInt(e*a.options.itemsDelayInterval)+"ms":parseInt(Math.abs(s-e)*a.options.itemsDelayInterval)+"ms",e===(s<=c/2||o?c-1:0)&&(n=function(){"r2l"===a.options.direction?(u.classList.remove(o?"animate-outToRight":"animate-outToLeft"),r.classList.remove(o?"animate-inFromLeft":"animate-inFromRight")):(u.classList.remove(o?"animate-outToLeft":"animate-outToRight"),r.classList.remove(o?"animate-inFromRight":"animate-inFromLeft")),u.classList.remove("menu__level--current"),r.classList.add("menu__level--current"),a.current_menu=m,o?0===a.current_menu&&a.options.backCtrl&&a.backCtrl.classList.add("menu__back--hidden"):(a.options.backCtrl&&a.backCtrl.classList.remove("menu__back--hidden"),a._addBreadcrumb(m)),a.isAnimating=!1,r.focus()},i=function(t){t.target===this&&(this.removeEventListener("animationend",i),n&&"function"==typeof n&&n.call())},t.addEventListener("animationend",i))}),"r2l"===this.options.direction?r.classList.add(o?"animate-inFromLeft":"animate-inFromRight"):r.classList.add(o?"animate-inFromRight":"animate-inFromLeft")},t.prototype._addBreadcrumb=function(i){if(!this.options.breadcrumbsCtrl)return!1;var r=document.createElement("a");r.href="#",r.innerHTML=i?this.menusArr[i].name:this.options.initialBreadcrumb,0===i?r.classList.add(this.options.initialBreadcrumbClass,"invisible"):this.breadcrumbsCtrl.firstElementChild.classList.remove("invisible"),this.breadcrumbsCtrl.appendChild(r);var s=this;r.addEventListener("click",function(t){if(t.preventDefault(),!r.nextSibling||s.isAnimating)return!1;s.isAnimating=!0,s._menuOut();var e,n=s.menusArr[i].menuEl;for(s._menuIn(n);e=r.nextSibling;)s.breadcrumbsCtrl.removeChild(e);r.previousSibling||r.classList.add("invisible")})},t.prototype._crawlCrumbs=function(t,e){0!==e[t].backIdx&&this._crawlCrumbs(e[t].backIdx,e),this._addBreadcrumb(t)},i.MLMenu=t}(window);